# A2Z 자율주행 차량 고장 시나리오 종합 분석
## CBS/FRER 기반 대응 전략

---

## 1. 단일 고장 시나리오

### 시나리오 1-1: LAN9662 단일 스위치 전원 고장
```
발생 조건: LAN9662-2 (Front Center) 전원부 고장
확률: 0.1% (연간)
영향 범위: Front Center LiDAR + Camera 손실

FRER 대응:
- T+0ms: 고장 감지
- T+1ms: FRER 경로 자동 절체 시작
- T+10ms: Secondary/Tertiary 경로 활성화
- T+10ms: 정상 데이터 플로우 복구

CBS 대응:
- 인접 스위치로 대역폭 재할당
- LAN9662-1,3에서 추가 400Mbps 처리

결과: ✅ 무중단 운영 지속
```

### 시나리오 1-2: 광케이블 단선
```
발생 조건: 차량 진동으로 광커넥터 분리
확률: 0.5% (연간)
영향 범위: 단일 링크 손실

FRER 대응:
- 3중 경로 중 1개 손실
- 나머지 2개 경로로 정상 운영
- Sequence recovery 정상 작동

CBS 대응:
- 영향 없음 (다른 경로 사용)

결과: ✅ 성능 저하 없음
```

### 시나리오 1-3: LiDAR 센서 고장
```
발생 조건: LiDAR 하드웨어 결함
확률: 0.3% (연간)
영향 범위: 단일 LiDAR 데이터 손실

시스템 대응:
- 인접 LiDAR로 커버리지 보상
- 6대 중 5대로 운영
- AI 센서 융합으로 보완

FRER 영향:
- 고장 센서의 FRER 스트림 중단
- 다른 센서 FRER 정상 작동

결과: ⚠️ 제한적 운영 (속도 50km/h 제한)
```

---

## 2. 다중 고장 시나리오

### 시나리오 2-1: 2개 LAN9662 동시 고장
```
발생 조건: 서지 전압으로 인한 다중 스위치 손상
확률: 0.01% (연간)
영향 범위: 2개 Zone 통신 손실

상황 분석:
- LAN9662-1, LAN9662-2 동시 고장
- Front Zone 완전 손실 위험

FRER 대응:
- LAN9662-3 경유 우회 경로 활성화
- Cross-zone 백업 경로 사용
- 응답시간 증가 (10ms → 20ms)

CBS 대응:
- 잔여 4개 스위치로 부하 분산
- 우선순위 재조정
- 비필수 트래픽 차단

결과: ⚠️ 비상 모드 전환, 안전 정지 준비
```

### 시나리오 2-2: LAN9692 중앙 스위치 고장
```
발생 조건: 중앙 스위치 하드웨어 결함
확률: 0.05% (연간)
영향 범위: 전체 백본 네트워크

즉각 대응 (T+0~1초):
1. Watchdog 타이머 트리거
2. 비상 전원 전환 시도
3. 하드웨어 리셋 시도

단기 대응 (T+1~5초):
1. LAN9662 간 Ad-hoc 네트워크 구성
2. P2P 직접 통신 모드
3. 최소 기능 모드 전환

장기 대응 (T+5초 이후):
1. 안전 정지 수행
2. 수동 운전 모드 전환
3. 긴급 알림 발송

결과: 🔴 안전 정지 필수
```

### 시나리오 2-3: FRER 모든 경로 동시 장애
```
발생 조건: 심각한 전자파 간섭 (EMP)
확률: 0.001% (연간)
영향 범위: 모든 이중화 경로

상황:
- Primary, Secondary, Tertiary 모든 경로 장애
- FRER 복구 불가능
- 패킷 손실 급증

대응:
1. 단일 경로 강제 선택
2. CBS 최대 대역폭 할당
3. Error correction 코드 활성화
4. 속도 20km/h 이하 제한

결과: 🔴 즉시 정지 후 시스템 재시작
```

---

## 3. 환경적 복합 고장

### 시나리오 3-1: 폭우 + 센서 오염 + 네트워크 부하
```
환경 조건:
- 시간당 100mm 폭우
- 카메라/라이다 렌즈 오염
- V2X 트래픽 폭증

시스템 영향:
1. 카메라 인식률 30% 저하
2. 라이다 유효거리 50% 감소
3. 네트워크 지연 2배 증가

CBS/FRER 대응:
- CBS: 라이다 우선순위 최대화 (600Mbps)
- FRER: 모든 경로 활성화 (Active-Active)
- QoS: 안전 관련 트래픽만 허용

단계별 대응:
1분: 속도 40km/h 제한
3분: 차선 변경 금지
5분: 안전 지대 정차

결과: ⚠️ 제한 운행 후 정차
```

### 시나리오 3-2: 고온 + 진동 + 먼지
```
환경 조건:
- 외부 온도 45°C
- 비포장 도로 주행
- 미세먼지 농도 극심

하드웨어 영향:
- 스위치 온도 85°C 도달
- 커넥터 접촉 불량
- 팬 필터 막힘

대응 시나리오:
1. 온도 경고 (75°C)
   - CPU 클럭 다운
   - 비필수 기능 중단
   
2. 임계 온도 (80°C)
   - 백업 냉각 시스템 가동
   - 네트워크 부하 50% 감소
   
3. 위험 온도 (85°C)
   - 즉시 안전 정지
   - 시스템 셧다운

결과: 🔴 열 보호 셧다운
```

---

## 4. 사이버 보안 관련 고장

### 시나리오 4-1: DDoS 공격 + 스위치 고장
```
공격 패턴:
- 10Gbps DDoS 트래픽
- 동시에 LAN9662-3 하드웨어 고장

보안 대응:
1. ACL 자동 활성화
2. Rate limiting 적용
3. 의심 트래픽 격리

네트워크 대응:
- FRER: 고장 스위치 우회
- CBS: DDoS 트래픽 0% 할당
- 정상 트래픽만 처리

결과: ✅ 공격 차단, 정상 운영
```

### 시나리오 4-2: 펌웨어 변조 시도
```
공격 벡터:
- 악성 펌웨어 주입 시도
- 설정 파일 변조

방어 메커니즘:
1. Secure Boot 검증 실패
2. 펌웨어 롤백 자동 수행
3. 안전 모드 부팅
4. 알림 발송

결과: ✅ 공격 무력화
```

---

## 5. 스위스 치즈 모델 적용 시나리오

### 복합 취약점 정렬 시나리오
```
Layer 1 (Hardware): 커넥터 부식 진행중
Layer 2 (Software): 메모리 누수 발생
Layer 3 (Network): 대역폭 90% 사용중
Layer 4 (Protocol): FRER 시퀀스 오류 간헐적
Layer 5 (Human): 정비 일정 지연

위험 정렬 순간:
- 급제동 상황 발생
- 모든 층의 구멍이 일시적 정렬
- 사고 위험 급증

다층 방어 작동:
1. Hardware: 이중화 커넥터 자동 전환
2. Software: Watchdog 리셋
3. Network: CBS 긴급 우선순위
4. Protocol: FRER 강제 리셋
5. Human: 원격 개입

결과: ✅ 사고 방지 성공
```

---

## 6. 복구 시간 목표 (RTO)

| 고장 유형 | 감지 시간 | 복구 시간 | 데이터 손실 |
|---------|----------|----------|-----------|
| 단일 스위치 고장 | < 1ms | < 10ms | 0 |
| 케이블 단선 | < 1ms | < 10ms | 0 |
| 센서 고장 | < 100ms | N/A | 최소 |
| 이중 스위치 고장 | < 1ms | < 50ms | < 0.01% |
| 중앙 스위치 고장 | < 10ms | 5초 (정지) | < 0.1% |
| 전체 시스템 고장 | < 100ms | 즉시 정지 | N/A |

---

## 7. 교훈 및 개선사항

### 주요 교훈
1. **FRER 3중화 필수**: 2중화로는 부족, 최소 3경로 필요
2. **CBS 동적 할당**: 고정 할당보다 동적 재할당 유리
3. **온도 관리 중요**: 냉각 시스템 이중화 필수
4. **정기 점검 준수**: 예방 정비가 최선의 대책

### 개선 계획
1. **하드웨어**: 
   - LAN9662 → 8대로 증설 검토
   - 액티브 냉각 시스템 추가

2. **소프트웨어**:
   - AI 기반 고장 예측 시스템
   - 자동 복구 알고리즘 고도화

3. **프로세스**:
   - 월간 모의 고장 훈련
   - 실시간 원격 모니터링 강화

---

## 8. 결론

A2Z TSN 네트워크는 **6대 LAN9662 + 1대 LAN9692** 구성으로 대부분의 단일/이중 고장에 대해 무중단 운영이 가능합니다. 

**핵심 성공 요인:**
- FRER 3중 경로로 완벽한 이중화
- CBS로 라이다 400Mbps 절대 보장
- 메시 토폴로지로 다중 우회 경로
- 스위스 치즈 모델 다층 방어

**잔존 위험:**
- 중앙 스위치 고장 (단일 장애점)
- 극한 환경 조건
- 동시 다발적 고장

**위험 수용 수준: ASIL-D 달성** ✅

---

*Document Version: 1.0*
*Last Updated: 2025.01.09*
*Next Review: 2025.02.09*
*Author: TSN Team*